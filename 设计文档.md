# ğŸ® CnoomFramework è®¾è®¡æ–‡æ¡£

## ğŸ“Œ æ ¸å¿ƒå®šä½

æ¡†æ¶ç®¡ç†ç±»ï¼ˆ`App` æˆ– `FrameworkManager`ï¼‰æ˜¯æ•´ä¸ªæ¡†æ¶çš„å”¯ä¸€æ ¸å¿ƒå•ä¾‹ï¼Œè´Ÿè´£ï¼š

* ç®¡ç† **æ¨¡å—** çš„ç”Ÿå‘½å‘¨æœŸ
* æŒæœ‰ **äº‹ä»¶æ€»çº¿ï¼ˆEventBusï¼‰**
* æä¾› **è°ƒè¯•ã€å¥‘çº¦éªŒè¯ã€ä¾èµ–ç®¡ç†ã€Mockæ›¿æ¢ã€çƒ­æ›¿æ¢** ç­‰é™„åŠ èƒ½åŠ›

> âš ï¸ æ¡†æ¶ä¸­æ‰€æœ‰åŠŸèƒ½å•å…ƒéƒ½æ˜¯ **æ¨¡å—**ï¼Œä¸å­˜åœ¨æœåŠ¡æ¦‚å¿µã€‚æ¨¡å—é—´ä¸ç›´æ¥ä¾èµ–ï¼Œä¸€åˆ‡é€šä¿¡é€šè¿‡ **äº‹ä»¶ / è¯·æ±‚-å“åº” / å¹¿æ’­** å®Œæˆã€‚

---

## ğŸ—ï¸ ç®¡ç†ç±»åŠŸèƒ½æ¸…å•

### 1ï¸âƒ£ æ¨¡å—ç”Ÿå‘½å‘¨æœŸç®¡ç†

æ¨¡å—æ”¯æŒä¸‰é˜¶æ®µç”Ÿå‘½å‘¨æœŸï¼š

| é˜¶æ®µ         | åŠŸèƒ½            | è¯´æ˜                    |
| ---------- | ------------- | --------------------- |
| `Init`     | æ³¨å†Œäº‹ä»¶ã€å‡†å¤‡èµ„æº     | å¼‚å¸¸æ•è·å¹¶è®°å½•ï¼›æ”¯æŒç‰¹æ€§è‡ªåŠ¨æ³¨å†Œäº‹ä»¶è®¢é˜…  |
| `Start`    | å¯åŠ¨é€»è¾‘ï¼Œå¯å®‰å…¨å‘é€äº‹ä»¶  | ä¾èµ–æ¨¡å—å·²å…¨éƒ¨åˆå§‹åŒ–å®Œæˆ          |
| `Shutdown` | æ¸…ç†èµ„æºã€è‡ªåŠ¨å–æ¶ˆäº‹ä»¶è®¢é˜… | å¼‚å¸¸ä¸ä¼šä¸­æ–­å…¨å±€ï¼›å¯é‡ç½®æ¨¡å—çŠ¶æ€ç”¨äºçƒ­æ›¿æ¢ |

#### æ¨¡å—çŠ¶æ€ç®¡ç†

```csharp
public enum ModuleState
{
    Uninitialized,
    Initialized,
    Started,
    Shutdown
}
```

* æ¡†æ¶å¯é€šè¿‡äº‹ä»¶æˆ–è°ƒè¯•å·¥å…·è¿½è¸ªæ¨¡å—çŠ¶æ€
* ä¾¿äºçƒ­æ›¿æ¢å’Œäº‹ä»¶æµå¯è§†åŒ–

#### ä¾èµ–å£°æ˜

```csharp
[DependsOn(typeof(DataModule))]
public class CombatModule : IModule { â€¦ }
```

* æ¡†æ¶è‡ªåŠ¨æ’åºæ¨¡å—åˆå§‹åŒ–é¡ºåº
* å¯¹ä¸­å°å‹é¡¹ç›®ï¼Œä¾èµ–å£°æ˜å¯é€‰ï¼Œç”±å¼€å‘è€…æ‰‹åŠ¨ç®¡ç†

#### å»¶è¿Ÿåˆå§‹åŒ–ä¸äº‹ä»¶ç¼“å­˜

* æœªå‡†å¤‡å¥½æ—¶äº‹ä»¶å¯ç¼“å­˜ï¼Œé¡ºåºä¿æŒ
* å¯é…ç½®æœ€å¤§ç¼“å­˜é•¿åº¦æˆ–å»¶è¿Ÿç­–ç•¥
* ç®€åŒ–æ–¹æ¡ˆï¼šåªç¼“å­˜å…³é”®äº‹ä»¶ï¼Œå…¶ä»–äº‹ä»¶ä¸¢å¼ƒæˆ–å»¶è¿Ÿä¸€å¸§

#### å¼‚å¸¸å¤„ç†ç­–ç•¥

* é»˜è®¤â€œè®°å½• + ç»§ç»­åˆå§‹åŒ–â€ï¼Œå¯é€‰â€œå¼‚å¸¸åœæ­¢åç»­æ¨¡å— Initâ€

---

### 2ï¸âƒ£ äº‹ä»¶æ€»çº¿ï¼ˆEventBusï¼‰

#### ç‰¹æ€§è‡ªåŠ¨è®¢é˜…/å–æ¶ˆæ³¨å†Œ

```csharp
[SubscribeEvent(typeof(IHealthChangedEvent))]
private void OnHealthChanged(IHealthChangedEvent evt)
{
    ui.UpdateHealthBar(evt.NewValue);
}
```

* Init æ—¶è‡ªåŠ¨æ³¨å†Œäº‹ä»¶
* Shutdown æ—¶è‡ªåŠ¨è§£ç»‘
* æ”¯æŒä¼˜å…ˆçº§ã€å¼‚æ­¥å¤„ç†ã€ç»§æ‰¿åˆ†å‘

#### æ¡†æ¶çº§äº‹ä»¶æ¥å£

```csharp
// æ‰€æœ‰æ¡†æ¶äº‹ä»¶ç»§æ‰¿ IFrameworkEvent
public interface IFrameworkEvent { }

// æ¨¡å—æ³¨å†Œäº‹ä»¶
public interface IModuleRegisteredEvent : IFrameworkEvent
{
    string ModuleName { get; }
}

// æ¨¡å—æ³¨é”€äº‹ä»¶
public interface IModuleUnregisteredEvent : IFrameworkEvent
{
    string ModuleName { get; }
}
```

#### æ¡†æ¶äº‹ä»¶ç¤ºä¾‹

```csharp
// æ¨¡å—æ³¨å†Œ
_eventBus.Publish<IModuleRegisteredEvent>(
    new ModuleRegisteredEvent(module.Name)
);

// æ¨¡å—æ³¨é”€
_eventBus.Publish<IModuleUnregisteredEvent>(
    new ModuleUnregisteredEvent(module.Name)
);

// ç‰¹æ€§è®¢é˜…
[SubscribeEvent]
private void OnModuleRegistered(IModuleRegisteredEvent evt)
{
    logger.Log($"æ¨¡å—æ³¨å†Œï¼š{evt.ModuleName}");
}
```

---

### 3ï¸âƒ£ è°ƒè¯•ä¸äº‹ä»¶æµå¯è§†åŒ–

* **äº‹ä»¶æ—¥å¿—æœåŠ¡**ï¼šè®°å½•äº‹ä»¶ç±»å‹ã€å‘é€è€…ã€æ¥æ”¶è€…ã€æ—¶é—´æˆ³
* **äº‹ä»¶æµå¯è§†åŒ–ï¼ˆEditor å·¥å…·ï¼‰**ï¼š

  * åŠŸèƒ½äº‹ä»¶ä¸æ¡†æ¶äº‹ä»¶åˆ†å±‚æ˜¾ç¤º
  * ç‚¹å‡»äº‹ä»¶å¯æŸ¥çœ‹æ¨¡å—æ–¹æ³•ã€è°ƒç”¨é¡ºåºã€çŠ¶æ€

> âš ï¸ é«˜é¢‘é€»è¾‘å»ºè®®å…³é—­è¯¦ç»†æ—¥å¿—

---

### 4ï¸âƒ£ æ€§èƒ½åˆ†å±‚é€šä¿¡

* **ä½é¢‘é€»è¾‘** â†’ äº‹ä»¶æ€»çº¿ï¼ˆUIåˆ·æ–°ã€æˆ˜æ–—ç»“æœã€æ¨¡å—æ³¨å†Œ/æ³¨é”€ï¼‰
* **é«˜é¢‘é€»è¾‘** â†’ æ¨¡å—é—´ç›´æ¥è°ƒç”¨ï¼ˆæˆ˜æ–— Tickã€æ•°å€¼è¿ç®—ï¼‰
* **å¼‚æ­¥äº‹ä»¶å¤„ç†**ï¼š

  * é«˜é¢‘äº‹ä»¶å¯å¼‚æ­¥é˜Ÿåˆ—å¤„ç†
  * é¿å…é˜»å¡ä¸»çº¿ç¨‹

---

### 5ï¸âƒ£ Mock / æ›¿æ¢å®ç°

* æ¨¡å—é€šè¿‡æ¥å£æ³¨å†Œï¼Œå¯æ›¿æ¢ Mock å®ç°ï¼š

```csharp
App.Register<ICombatModule>(new MockCombatModule());
```

* ç”Ÿå‘½å‘¨æœŸç»‘å®šï¼Œçƒ­æ›¿æ¢æ—¶å¯ä¸´æ—¶æ›¿æ¢æ¨¡å—å®ç°
* å¿«é€Ÿæ¨¡å—æ¨¡æ¿åŒ…å«ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ã€ç‰¹æ€§æ³¨å†Œç¤ºä¾‹ã€Mock æ”¯æŒ

---

### 6ï¸âƒ£ å®‰å…¨é˜²æŠ¤

* **å¥‘çº¦éªŒè¯**ï¼šç¡®ä¿äº‹ä»¶/è¯·æ±‚åœ¨å¥‘çº¦ä¸­å®šä¹‰
* **å¼‚å¸¸ä¿æŠ¤**ï¼šäº‹ä»¶åˆ†å‘æ•è·å¼‚å¸¸ï¼Œé¿å…å•æ¨¡å—å´©æºƒå½±å“å…¨å±€
* **çƒ­æ›¿æ¢æ”¯æŒ**ï¼š

  * æ¨¡å—çŠ¶æ€å¯ä¿ç•™æˆ–é‡ç½®
  * è‡ªåŠ¨å¤„ç†äº‹ä»¶ç¼“å­˜

---

## ğŸ“Š æ¨¡å—é€šä¿¡ç¤ºä¾‹

```csharp
// åŠŸèƒ½äº‹ä»¶
public interface ICombatEvent { }
public interface IHealthChangedEvent : ICombatEvent
{
    int OldValue { get; }
    int NewValue { get; }
}

// å‘å¸ƒåŠŸèƒ½äº‹ä»¶
_eventBus.Publish<IHealthChangedEvent>(
    new HealthChangedEvent(oldValue, newValue)
);

// ç‰¹æ€§è®¢é˜…
[SubscribeEvent(typeof(IHealthChangedEvent))]
private void OnHealthChanged(IHealthChangedEvent evt)
{
    ui.UpdateHealthBar(evt.NewValue);
}

// æ¡†æ¶çº§äº‹ä»¶è®¢é˜…
[SubscribeEvent(typeof(IModuleRegisteredEvent))]
private void OnModuleRegistered(IModuleRegisteredEvent evt)
{
    logger.Log($"æ¨¡å—æ³¨å†Œï¼š{evt.ModuleName}");
}

// è¯·æ±‚/å“åº”ç¤ºä¾‹
var inventory = _eventBus.Request<GetInventoryRequest, Inventory>();
```

---

## âœ… æ€»ç»“

æœ€ç»ˆç‰¹æ€§ï¼š

* æ¨¡å—å®Œå…¨è§£è€¦ï¼Œä¾èµ–é€šè¿‡äº‹ä»¶/è¯·æ±‚å®Œæˆ
* ç”Ÿå‘½å‘¨æœŸç®¡ç†æ¸…æ™°ï¼Œæ”¯æŒçŠ¶æ€è¿½è¸ªä¸çƒ­æ›¿æ¢
* äº‹ä»¶ç³»ç»Ÿå¼ºå¤§ä¸”æ˜“ç”¨ï¼Œæ”¯æŒç‰¹æ€§è‡ªåŠ¨æ³¨å†Œã€ä¼˜å…ˆçº§ã€å¼‚æ­¥ã€ç»§æ‰¿åˆ†å‘
* æ¡†æ¶çº§äº‹ä»¶æ¥å£ï¼Œè·Ÿè¸ªæ¨¡å—æ³¨å†Œ/æ³¨é”€/çŠ¶æ€å˜åŒ–
* æ€§èƒ½åˆ†å±‚é€šä¿¡ï¼Œé«˜é¢‘é€»è¾‘ç›´æ¥è°ƒç”¨ï¼Œä½é¢‘é€»è¾‘èµ°äº‹ä»¶
* è°ƒè¯•ä¸å¯è§†åŒ–å·¥å…·å®Œå–„
* Mockæ›¿æ¢å’Œå¿«é€Ÿæ¨¡å—æ¨¡æ¿æ”¯æŒæµ‹è¯•ä¸åŸå‹å¼€å‘
* å¼‚æ­¥äº‹ä»¶å¤„ç†ï¼Œé™ä½ä¸»çº¿ç¨‹é˜»å¡

> é€‚åˆä¸­å°å‹é¡¹ç›®å¿«é€Ÿå¼€å‘ï¼Œä¿æŒæ¨¡å—è§£è€¦ã€å¯ç»´æŠ¤æ€§é«˜ã€è°ƒè¯•å‹å¥½ã€‚
