# ğŸš€ æ€§èƒ½ç›‘æ§ç³»ç»Ÿä½¿ç”¨ç¤ºä¾‹

## å¿«é€Ÿå¼€å§‹

### 1. å¯ç”¨æ€§èƒ½ç›‘æ§

```csharp
// åœ¨æ¡†æ¶åˆå§‹åŒ–åå¯ç”¨æ€§èƒ½ç›‘æ§
public class GameManager : MonoBehaviour
{
    void Start()
    {
        // åˆå§‹åŒ–æ¡†æ¶
        var frameworkManager = FrameworkManager.Instance;
        frameworkManager.Initialize();
        
        // è·å–å¹¶å¯ç”¨æ€§èƒ½ç›‘æ§
        var performanceMonitor = PerformanceMonitor.Instance;
        performanceMonitor.SetEnabled(true);
        
        // åˆå§‹åŒ–æ€§èƒ½æ‹¦æˆªå™¨
        PerformanceInterceptor.Initialize(performanceMonitor);
        
        Debug.Log("æ€§èƒ½ç›‘æ§ç³»ç»Ÿå·²å¯ç”¨");
    }
}
```

### 2. ä½¿ç”¨ç‰¹æ€§æ ‡è®°ç›‘æ§æ–¹æ³•

```csharp
public class PlayerController : BaseModule
{
    [MonitorPerformance("ç©å®¶æ›´æ–°")]
    void Update()
    {
        ProcessInput();
        UpdateMovement();
        UpdateAnimation();
    }
    
    [MonitorPerformance("è¾“å…¥å¤„ç†", true)]
    private void ProcessInput()
    {
        // è¾“å…¥å¤„ç†é€»è¾‘
        if (Input.GetKey(KeyCode.W))
            transform.Translate(Vector3.forward * Time.deltaTime * 5f);
    }
    
    [MonitorPerformance("ç§»åŠ¨æ›´æ–°")]
    private void UpdateMovement()
    {
        // ç§»åŠ¨é€»è¾‘
        var targetPosition = CalculateTargetPosition();
        transform.position = Vector3.Lerp(transform.position, targetPosition, Time.deltaTime * 2f);
    }
    
    [MonitorPerformance("åŠ¨ç”»æ›´æ–°")]
    private void UpdateAnimation()
    {
        // åŠ¨ç”»é€»è¾‘
        var animator = GetComponent<Animator>();
        animator.SetFloat("Speed", GetComponent<Rigidbody>().velocity.magnitude);
    }
    
    private Vector3 CalculateTargetPosition()
    {
        // å¤æ‚çš„ä½ç½®è®¡ç®—
        return transform.position + Vector3.forward * Time.deltaTime;
    }
}
```

### 3. æ‰‹åŠ¨ç›‘æ§ä»£ç å—

```csharp
public class AIController : BaseModule
{
    void Update()
    {
        // ä½¿ç”¨ç›‘æ§ä½œç”¨åŸŸ
        using (PerformanceInterceptor.CreateScope("AIå†³ç­–", "AIModule"))
        {
            MakeDecision();
        }
        
        // ä½¿ç”¨æ‰©å±•æ–¹æ³•
        var pathfindingAction = CalculatePath.WithPerformanceMonitoring("è·¯å¾„è®¡ç®—", "AIModule");
        pathfindingAction();
    }
    
    private void MakeDecision()
    {
        // AIå†³ç­–é€»è¾‘
        System.Threading.Thread.Sleep(1); // æ¨¡æ‹Ÿå¤æ‚è®¡ç®—
    }
    
    private void CalculatePath()
    {
        // è·¯å¾„è®¡ç®—é€»è¾‘
        for (int i = 0; i < 1000; i++)
        {
            var distance = Vector3.Distance(Vector3.zero, Vector3.one * i);
        }
    }
}
```

### 4. æŸ¥çœ‹æ€§èƒ½æ•°æ®

```csharp
public class PerformanceReporter : MonoBehaviour
{
    void Start()
    {
        // æ¯5ç§’è¾“å‡ºä¸€æ¬¡æ€§èƒ½æŠ¥å‘Š
        InvokeRepeating(nameof(PrintPerformanceReport), 5f, 5f);
    }
    
    private void PrintPerformanceReport()
    {
        var monitor = PerformanceMonitor.Instance;
        var allStats = monitor.GetAllStats();
        
        Debug.Log("=== æ€§èƒ½æŠ¥å‘Š ===");
        foreach (var kvp in allStats)
        {
            var stats = kvp.Value;
            Debug.Log($"{stats.OperationName}: å¹³å‡{stats.AverageTimeMs:F2}ms, è°ƒç”¨{stats.CallCount}æ¬¡");
        }
        
        // è·å–ç‰¹å®šæ“ä½œçš„è¯¦ç»†ç»Ÿè®¡
        var playerUpdateStats = monitor.GetStats("ç©å®¶æ›´æ–°");
        if (playerUpdateStats != null)
        {
            Debug.Log($"ç©å®¶æ›´æ–°è¯¦ç»†ç»Ÿè®¡: {playerUpdateStats}");
        }
    }
}
```

### 5. åœ¨Unityç¼–è¾‘å™¨ä¸­æŸ¥çœ‹ç›‘æ§ç•Œé¢

1. åœ¨Unityç¼–è¾‘å™¨èœå•ä¸­é€‰æ‹©ï¼š`Cnoom Framework -> Performance Monitor`
2. ç›‘æ§ç•Œé¢å°†æ˜¾ç¤ºï¼š
   - å®æ—¶æ€§èƒ½å›¾è¡¨
   - æ–¹æ³•æ‰§è¡Œæ—¶é—´æ’è¡Œ
   - å†å²æ€§èƒ½æ•°æ®
   - é…ç½®é€‰é¡¹

### 6. é…ç½®ç›‘æ§å‚æ•°

```csharp
public class PerformanceConfig : MonoBehaviour
{
    void Start()
    {
        var monitor = PerformanceMonitor.Instance;
        
        // å¯ç”¨/ç¦ç”¨ç›‘æ§
        monitor.SetEnabled(true);
        
        // æ¸…ç©ºå†å²æ•°æ®
        monitor.ClearStats();
        
        // è®°å½•è‡ªå®šä¹‰æ€§èƒ½æ•°æ®
        monitor.RecordSample("è‡ªå®šä¹‰æ“ä½œ", TimeSpan.FromMilliseconds(15.5));
    }
}
```

## é«˜çº§ç”¨æ³•

### æ¡ä»¶ç›‘æ§

```csharp
public class ConditionalMonitoring : BaseModule
{
    [MonitorPerformance("é‡å‹è®¡ç®—")]
    public void HeavyComputation()
    {
        // åªåœ¨å¼€å‘ç‰ˆæœ¬ä¸­ç›‘æ§
        #if UNITY_EDITOR || DEVELOPMENT_BUILD
        using (PerformanceInterceptor.CreateScope("è¯¦ç»†è®¡ç®—æ­¥éª¤"))
        {
            DetailedCalculation();
        }
        #else
        DetailedCalculation();
        #endif
    }
    
    private void DetailedCalculation()
    {
        // å¤æ‚è®¡ç®—é€»è¾‘
    }
}
```

### æ€§èƒ½äº‹ä»¶å¤„ç†

```csharp
public class PerformanceEventHandler : BaseModule
{
    void Start()
    {
        // ç›‘å¬æ€§èƒ½ç›¸å…³äº‹ä»¶
        EventBus.Subscribe<PerformanceWarningEvent>(OnPerformanceWarning);
    }
    
    private void OnPerformanceWarning(PerformanceWarningEvent evt)
    {
        if (evt.ExecutionTimeMs > 16.67f) // è¶…è¿‡ä¸€å¸§æ—¶é—´
        {
            Debug.LogWarning($"æ€§èƒ½è­¦å‘Š: {evt.OperationName} æ‰§è¡Œæ—¶é—´è¿‡é•¿ ({evt.ExecutionTimeMs:F2}ms)");
            
            // å¯ä»¥åœ¨è¿™é‡Œå®ç°è‡ªåŠ¨ä¼˜åŒ–é€»è¾‘
            OptimizePerformance(evt.OperationName);
        }
    }
    
    private void OptimizePerformance(string operationName)
    {
        // å®ç°æ€§èƒ½ä¼˜åŒ–é€»è¾‘
        Debug.Log($"æ­£åœ¨ä¼˜åŒ–æ“ä½œ: {operationName}");
    }
}
```

## æœ€ä½³å®è·µ

### 1. é€‰æ‹©æ€§ç›‘æ§
- åªç›‘æ§å…³é”®è·¯å¾„å’Œæ€§èƒ½æ•æ„Ÿçš„æ–¹æ³•
- é¿å…ç›‘æ§è¿‡äºé¢‘ç¹è°ƒç”¨çš„ç®€å•æ–¹æ³•
- ä½¿ç”¨æ¡ä»¶ç¼–è¯‘åœ¨å‘å¸ƒç‰ˆæœ¬ä¸­ç¦ç”¨è¯¦ç»†ç›‘æ§

### 2. åˆç†å‘½å
- ä½¿ç”¨æœ‰æ„ä¹‰çš„æ“ä½œåç§°
- ä¿æŒå‘½åä¸€è‡´æ€§
- åŒ…å«æ¨¡å—ä¿¡æ¯ä¾¿äºåˆ†ç±»

### 3. æ€§èƒ½ä¼˜åŒ–
- å®šæœŸæŸ¥çœ‹æ€§èƒ½æŠ¥å‘Š
- å…³æ³¨å¹³å‡æ‰§è¡Œæ—¶é—´å’Œæœ€å¤§æ‰§è¡Œæ—¶é—´
- ä¼˜åŒ–æ‰§è¡Œæ—¶é—´è¶…è¿‡16.67msçš„æ“ä½œï¼ˆ60FPSï¼‰

### 4. æ•°æ®ç®¡ç†
- å®šæœŸæ¸…ç†å†å²æ•°æ®é¿å…å†…å­˜å ç”¨è¿‡å¤š
- åœ¨é€‚å½“çš„æ—¶å€™ç¦ç”¨ç›‘æ§å‡å°‘å¼€é”€
- ä½¿ç”¨é‡‡æ ·ç­–ç•¥å¤„ç†é«˜é¢‘æ“ä½œ

è¿™ä¸ªæ€§èƒ½ç›‘æ§ç³»ç»Ÿä¸ºæ‚¨çš„Unityé¡¹ç›®æä¾›äº†å¼ºå¤§è€Œçµæ´»çš„æ€§èƒ½åˆ†æèƒ½åŠ›ï¼Œå¸®åŠ©æ‚¨å¿«é€Ÿè¯†åˆ«å’Œè§£å†³æ€§èƒ½ç“¶é¢ˆï¼