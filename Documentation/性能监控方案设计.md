# ğŸš€ Cnoom Unity Framework è½»é‡çº§æ€§èƒ½ç›‘æ§æ–¹æ¡ˆ

## ğŸ“‹ ç›®å½•
- [1. æ–¹æ¡ˆæ¦‚è¿°](#1-æ–¹æ¡ˆæ¦‚è¿°)
- [2. æ ¸å¿ƒç‰¹æ€§](#2-æ ¸å¿ƒç‰¹æ€§)
- [3. æ¶æ„è®¾è®¡](#3-æ¶æ„è®¾è®¡)
- [4. å®ç°ç»†èŠ‚](#4-å®ç°ç»†èŠ‚)
- [5. ä½¿ç”¨æŒ‡å—](#5-ä½¿ç”¨æŒ‡å—)
- [6. æ€§èƒ½ä¼˜åŒ–](#6-æ€§èƒ½ä¼˜åŒ–)
- [7. æ‰©å±•æŒ‡å—](#7-æ‰©å±•æŒ‡å—)

---

## 1. æ–¹æ¡ˆæ¦‚è¿°

### 1.1 è®¾è®¡ç›®æ ‡

æœ¬æ€§èƒ½ç›‘æ§æ–¹æ¡ˆæ—¨åœ¨ä¸ºCnoom Unity Frameworkæä¾›**è½»é‡çº§ã€æ— ä¾µå…¥æ€§ã€å¯é…ç½®**çš„æ€§èƒ½ç›‘æ§èƒ½åŠ›ï¼Œæ»¡è¶³ä»¥ä¸‹æ ¸å¿ƒéœ€æ±‚ï¼š

- âœ… **æ–¹æ³•çº§æ€§èƒ½æŒ‡æ ‡é‡‡é›†** - æ”¯æŒæ‰§è¡Œè€—æ—¶ã€èµ„æºå ç”¨ç­‰å…³é”®æŒ‡æ ‡
- âœ… **å¯é…ç½®ç›‘æ§ç²’åº¦** - æ”¯æŒæŒ‰æ¨¡å—/ç±»/æ–¹æ³•ç»´åº¦è¿›è¡Œç›‘æ§
- âœ… **å®æ—¶Unityç•Œé¢ç›‘æ§ä»ªè¡¨ç›˜** - æä¾›ç›´è§‚çš„å¯è§†åŒ–ç›‘æ§ç•Œé¢
- âœ… **ä¸šåŠ¡ä»£ç æ— ä¾µå…¥æ€§** - é€šè¿‡ç‰¹æ€§å’Œæ‹¦æˆªå™¨å®ç°é€æ˜ç›‘æ§

### 1.2 æŠ€æœ¯ç‰¹ç‚¹

| ç‰¹æ€§ | æè¿° | ä¼˜åŠ¿ |
|------|------|------|
| **è½»é‡çº§è®¾è®¡** | æœ€å°åŒ–æ€§èƒ½å¼€é”€ï¼Œé‡‡ç”¨é«˜æ•ˆçš„æ•°æ®ç»“æ„å’Œç®—æ³• | å¯¹ä¸šåŠ¡æ€§èƒ½å½±å“æå° |
| **æ— ä¾µå…¥ç›‘æ§** | é€šè¿‡ç‰¹æ€§æ ‡è®°å’Œæ‹¦æˆªå™¨å®ç°ï¼Œæ— éœ€ä¿®æ”¹ä¸šåŠ¡ä»£ç  | æ˜“äºé›†æˆå’Œç»´æŠ¤ |
| **å®æ—¶å¯è§†åŒ–** | Unityç¼–è¾‘å™¨å†…ç½®ç›‘æ§é¢æ¿ï¼Œå®æ—¶æ˜¾ç¤ºæ€§èƒ½æ•°æ® | ç›´è§‚çš„å¼€å‘ä½“éªŒ |
| **çµæ´»é…ç½®** | æ”¯æŒè¿è¡Œæ—¶åŠ¨æ€é…ç½®ç›‘æ§å‚æ•° | é€‚åº”ä¸åŒåœºæ™¯éœ€æ±‚ |
| **æ•°æ®æŒä¹…åŒ–** | æ”¯æŒæ€§èƒ½æ•°æ®å¯¼å‡ºå’Œå†å²è®°å½•æŸ¥è¯¢ | ä¾¿äºæ€§èƒ½åˆ†æå’Œä¼˜åŒ– |

### 1.3 ç›‘æ§èŒƒå›´

```mermaid
graph TD
    A[æ€§èƒ½ç›‘æ§èŒƒå›´] --> B[æ–¹æ³•çº§ç›‘æ§]
    A --> C[æ¨¡å—çº§ç›‘æ§]
    A --> D[ç³»ç»Ÿçº§ç›‘æ§]
    
    B --> B1[æ‰§è¡Œæ—¶é—´]
    B --> B2[å†…å­˜åˆ†é…]
    B --> B3[è°ƒç”¨é¢‘ç‡]
    
    C --> C1[æ¨¡å—åˆå§‹åŒ–æ—¶é—´]
    C --> C2[æ¨¡å—é—´é€šä¿¡æ€§èƒ½]
    C --> C3[äº‹ä»¶å¤„ç†æ€§èƒ½]
    
    D --> D1[FPSç›‘æ§]
    D --> D2[å†…å­˜ä½¿ç”¨]
    D --> D3[GCå‹åŠ›]
```

---

## 2. æ ¸å¿ƒç‰¹æ€§

### 2.1 æ–¹æ³•çº§æ€§èƒ½æŒ‡æ ‡é‡‡é›†

#### æ”¯æŒçš„æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ç±»å‹ | æè¿° | å•ä½ | ç”¨é€” |
|----------|------|------|------|
| **æ‰§è¡Œæ—¶é—´** | æ–¹æ³•ä»å¼€å§‹åˆ°ç»“æŸçš„è€—æ—¶ | æ¯«ç§’(ms) | è¯†åˆ«æ€§èƒ½ç“¶é¢ˆ |
| **å†…å­˜åˆ†é…** | æ–¹æ³•æ‰§è¡Œå‰åçš„å†…å­˜å˜åŒ– | å­—èŠ‚(bytes) | æ£€æµ‹å†…å­˜æ³„æ¼ |
| **è°ƒç”¨é¢‘ç‡** | å•ä½æ—¶é—´å†…çš„æ–¹æ³•è°ƒç”¨æ¬¡æ•° | æ¬¡/ç§’ | åˆ†æçƒ­ç‚¹æ–¹æ³• |
| **çº¿ç¨‹ä¿¡æ¯** | æ–¹æ³•æ‰§è¡Œæ‰€åœ¨çš„çº¿ç¨‹ID | - | å¹¶å‘åˆ†æ |
| **è°ƒç”¨å †æ ˆ** | æ–¹æ³•è°ƒç”¨çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ | - | é—®é¢˜å®šä½ |

#### ä½¿ç”¨ç¤ºä¾‹

```csharp
public class PlayerController : BaseModule
{
    [MonitorPerformance("ç©å®¶æ›´æ–°", RecordToGlobalStats = true)]
    public void UpdatePlayer()
    {
        // ä¸šåŠ¡é€»è¾‘
        ProcessMovement();
        ProcessAnimation();
        ProcessInput();
    }
    
    [MonitorPerformance("ç§»åŠ¨å¤„ç†")]
    private void ProcessMovement()
    {
        // ç§»åŠ¨é€»è¾‘
    }
}
```

### 2.2 å¯é…ç½®ç›‘æ§ç²’åº¦

#### ä¸‰çº§ç›‘æ§ç²’åº¦

```mermaid
graph LR
    A[ç›‘æ§ç²’åº¦] --> B[æ¨¡å—çº§]
    A --> C[ç±»çº§]
    A --> D[æ–¹æ³•çº§]
    
    B --> B1[æ•´ä¸ªæ¨¡å—çš„æ€§èƒ½ç»Ÿè®¡]
    C --> C1[ç‰¹å®šç±»çš„æ–¹æ³•ç›‘æ§]
    D --> D1[å•ä¸ªæ–¹æ³•çš„è¯¦ç»†ç›‘æ§]
```

#### é…ç½®æ–¹å¼

```csharp
// 1. å…¨å±€é…ç½®
ConfigManager.SetValue("Performance.EnableMonitoring", true);
ConfigManager.SetValue("Performance.MonitoringLevel", "Method"); // Module/Class/Method

// 2. æ¨¡å—çº§é…ç½®
[AutoRegisterModule]
[MonitorModule(Level = MonitoringLevel.Detailed)]
public class CombatModule : BaseModule { }

// 3. æ–¹æ³•çº§é…ç½®
[MonitorPerformance(
    OperationName = "æˆ˜æ–—è®¡ç®—",
    RecordToGlobalStats = true,
    EnableMemoryTracking = true,
    SamplingRate = 1.0f // 100%é‡‡æ ·
)]
public void CalculateDamage() { }
```

### 2.3 å®æ—¶Unityç•Œé¢ç›‘æ§ä»ªè¡¨ç›˜

#### ä»ªè¡¨ç›˜åŠŸèƒ½æ¨¡å—

| æ¨¡å— | åŠŸèƒ½ | ç‰¹ç‚¹ |
|------|------|------|
| **æ¦‚è§ˆé¢æ¿** | æ˜¾ç¤ºæ•´ä½“æ€§èƒ½çŠ¶å†µå’Œå…³é”®æŒ‡æ ‡ | ä¸€ç›®äº†ç„¶çš„ç³»ç»ŸçŠ¶æ€ |
| **å®æ—¶ç›‘æ§** | å®æ—¶å›¾è¡¨æ˜¾ç¤ºFPSã€å†…å­˜ã€æ‰§è¡Œæ—¶é—´ç­‰ | åŠ¨æ€æ€§èƒ½æ›²çº¿ |
| **å†å²æ•°æ®** | æŸ¥çœ‹å†å²æ€§èƒ½è®°å½•å’Œè¶‹åŠ¿åˆ†æ | æ”¯æŒè¿‡æ»¤å’Œæœç´¢ |
| **ç»Ÿè®¡åˆ†æ** | æ¨¡å—å’Œæ–¹æ³•çš„æ€§èƒ½ç»Ÿè®¡æ’è¡Œ | è¯†åˆ«æ€§èƒ½çƒ­ç‚¹ |
| **è®¾ç½®é¢æ¿** | é…ç½®ç›‘æ§å‚æ•°å’Œæ˜¾ç¤ºé€‰é¡¹ | çµæ´»çš„ä¸ªæ€§åŒ–è®¾ç½® |

#### ç•Œé¢é¢„è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ€§èƒ½ç›‘æ§ - Cnoom Framework                    [â—] ç›‘æ§ä¸­    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [æ¦‚è§ˆ] [å®æ—¶ç›‘æ§] [å†å²æ•°æ®] [ç»Ÿè®¡åˆ†æ] [è®¾ç½®]              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å®æ—¶æŒ‡æ ‡:  FPS: 60.0  å¸§æ—¶é—´: 16.7ms  å†…å­˜: 245MB  æ´»è·ƒ: 3 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  FPS å›¾è¡¨                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚     â•­â”€â•®                                             â”‚   â”‚
â”‚  â”‚   â•­â”€â•¯ â•°â”€â•®                                           â”‚   â”‚
â”‚  â”‚ â•­â”€â•¯     â•°â”€â•®                                         â”‚   â”‚
â”‚  â”‚â•±         â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚  æ‰§è¡Œæ—¶é—´ Top 5:                                           â”‚
â”‚  1. PlayerModule.UpdatePlayer     2.34ms  (1,234 æ¬¡)      â”‚
â”‚  2. UIModule.RefreshUI           1.89ms  (567 æ¬¡)         â”‚
â”‚  3. AudioModule.ProcessAudio     1.23ms  (890 æ¬¡)         â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. æ¶æ„è®¾è®¡

### 3.1 æ•´ä½“æ¶æ„

```mermaid
graph TB
    subgraph "ä¸šåŠ¡å±‚ (Business Layer)"
        A[ä¸šåŠ¡æ¨¡å—] --> B[MonitorPerformanceç‰¹æ€§]
    end
    
    subgraph "ç›‘æ§å±‚ (Monitoring Layer)"
        C[PerformanceInterceptor] --> D[PerformanceMonitor]
        D --> E[æ•°æ®æ”¶é›†å™¨]
        D --> F[ç»Ÿè®¡åˆ†æå™¨]
        D --> G[äº‹ä»¶å‘å¸ƒå™¨]
    end
    
    subgraph "å­˜å‚¨å±‚ (Storage Layer)"
        H[å†…å­˜ç¼“å­˜] --> I[æ€§èƒ½å†å²]
        H --> J[ç»Ÿè®¡æ•°æ®]
        H --> K[é…ç½®ä¿¡æ¯]
    end
    
    subgraph "å±•ç¤ºå±‚ (Presentation Layer)"
        L[PerformanceMonitorWindow] --> M[å®æ—¶å›¾è¡¨]
        L --> N[æ•°æ®è¡¨æ ¼]
        L --> O[é…ç½®ç•Œé¢]
    end
    
    B --> C
    E --> H
    F --> H
    G --> L
    H --> L
```

### 3.2 æ ¸å¿ƒç»„ä»¶è®¾è®¡

#### PerformanceMonitor - æ ¸å¿ƒç›‘æ§å™¨

```csharp
public class PerformanceMonitor : BaseModule
{
    // æ ¸å¿ƒåŠŸèƒ½
    - BeginMethodMonitoring()    // å¼€å§‹ç›‘æ§
    - EndMethodMonitoring()      // ç»“æŸç›‘æ§
    - RecordPerformanceMetrics() // è®°å½•æŒ‡æ ‡
    - GeneratePerformanceReport() // ç”ŸæˆæŠ¥å‘Š
    
    // æ•°æ®ç®¡ç†
    - GetPerformanceHistory()    // è·å–å†å²æ•°æ®
    - GetModuleStatistics()      // è·å–æ¨¡å—ç»Ÿè®¡
    - GetMethodStatistics()      // è·å–æ–¹æ³•ç»Ÿè®¡
    - ClearHistory()             // æ¸…ç©ºå†å²
    
    // é…ç½®ç®¡ç†
    - SetEnabled()               // å¯ç”¨/ç¦ç”¨ç›‘æ§
    - SetSamplingInterval()      // è®¾ç½®é‡‡æ ·é—´éš”
    - LoadConfiguration()        // åŠ è½½é…ç½®
}
```

#### PerformanceInterceptor - æ€§èƒ½æ‹¦æˆªå™¨

```csharp
public static class PerformanceInterceptor
{
    // æ‹¦æˆªåŠŸèƒ½
    - BeforeMethodExecution()    // æ–¹æ³•æ‰§è¡Œå‰æ‹¦æˆª
    - AfterMethodExecution()     // æ–¹æ³•æ‰§è¡Œåæ‹¦æˆª
    - MonitorOperation()         // æ‰‹åŠ¨ç›‘æ§æ“ä½œ
    - CreateScope()              // åˆ›å»ºç›‘æ§ä½œç”¨åŸŸ
    
    // è¾…åŠ©åŠŸèƒ½
    - GetModuleName()            // è·å–æ¨¡å—åç§°
    - Initialize()               // åˆå§‹åŒ–æ‹¦æˆªå™¨
}
```

### 3.3 æ•°æ®æµè®¾è®¡

```mermaid
sequenceDiagram
    participant BM as ä¸šåŠ¡æ–¹æ³•
    participant PI as PerformanceInterceptor
    participant PM as PerformanceMonitor
    participant DS as æ•°æ®å­˜å‚¨
    participant UI as ç›‘æ§ç•Œé¢
    
    BM->>PI: æ–¹æ³•è°ƒç”¨å¼€å§‹
    PI->>PM: BeginMethodMonitoring()
    PM->>PM: è®°å½•å¼€å§‹æ—¶é—´å’Œå†…å­˜
    PM-->>PI: è¿”å›ä¸Šä¸‹æ–‡ID
    
    PI->>BM: æ‰§è¡Œä¸šåŠ¡é€»è¾‘
    BM-->>PI: æ–¹æ³•æ‰§è¡Œå®Œæˆ
    
    PI->>PM: EndMethodMonitoring(contextId)
    PM->>PM: è®¡ç®—æ€§èƒ½æŒ‡æ ‡
    PM->>DS: å­˜å‚¨æ€§èƒ½æ•°æ®
    PM->>UI: å‘å¸ƒæ€§èƒ½äº‹ä»¶
    
    UI->>DS: æŸ¥è¯¢æ€§èƒ½æ•°æ®
    DS-->>UI: è¿”å›æ•°æ®
    UI->>UI: æ›´æ–°ç•Œé¢æ˜¾ç¤º
```

---

## 4. å®ç°ç»†èŠ‚

### 4.1 æ— ä¾µå…¥æ€§ç›‘æ§å®ç°

#### ç‰¹æ€§é©±åŠ¨çš„ç›‘æ§

```csharp
[AttributeUsage(AttributeTargets.Method)]
public class MonitorPerformanceAttribute : Attribute
{
    public string OperationName { get; set; }
    public bool RecordToGlobalStats { get; set; } = true;
    public bool EnableMemoryTracking { get; set; } = true;
    public float SamplingRate { get; set; } = 1.0f;
    public MonitoringLevel Level { get; set; } = MonitoringLevel.Method;
}
```

#### è‡ªåŠ¨æ‹¦æˆªæœºåˆ¶

é€šè¿‡åå°„å’Œä»£ç†æ¨¡å¼å®ç°è‡ªåŠ¨æ‹¦æˆªï¼š

```csharp
// åœ¨æ¨¡å—åˆå§‹åŒ–æ—¶è‡ªåŠ¨æ‰«æå’Œæ³¨å†Œç›‘æ§æ–¹æ³•
private void RegisterPerformanceMonitoring(IModule module)
{
    var type = module.GetType();
    var methods = type.GetMethods(BindingFlags.Instance | BindingFlags.Public | BindingFlags.NonPublic);
    
    foreach (var method in methods)
    {
        var attr = method.GetCustomAttribute<MonitorPerformanceAttribute>();
        if (attr != null)
        {
            // åˆ›å»ºæ–¹æ³•ä»£ç†ï¼Œåœ¨è°ƒç”¨å‰åæ’å…¥ç›‘æ§é€»è¾‘
            CreateMethodProxy(module, method, attr);
        }
    }
}
```

### 4.2 é«˜æ€§èƒ½æ•°æ®æ”¶é›†

#### å†…å­˜ä¼˜åŒ–çš„æ•°æ®ç»“æ„

```csharp
// ä½¿ç”¨å¯¹è±¡æ± å‡å°‘GCå‹åŠ›
private readonly ObjectPool<PerformanceMetrics> _metricsPool;

// ä½¿ç”¨ç¯å½¢ç¼“å†²åŒºå­˜å‚¨å†å²æ•°æ®
private readonly RingBuffer<PerformanceMetrics> _historyBuffer;

// ä½¿ç”¨å¹¶å‘é›†åˆæ”¯æŒå¤šçº¿ç¨‹è®¿é—®
private readonly ConcurrentDictionary<string, PerformanceStatistics> _statistics;
```

#### é«˜ç²¾åº¦æ—¶é—´æµ‹é‡

```csharp
// ä½¿ç”¨Stopwatchè·å¾—é«˜ç²¾åº¦æ—¶é—´æµ‹é‡
private static readonly long _stopwatchFrequency = Stopwatch.Frequency;

public static TimeSpan GetElapsedTime(long startTimestamp, long endTimestamp)
{
    var elapsedTicks = (endTimestamp - startTimestamp) * TimeSpan.TicksPerSecond / _stopwatchFrequency;
    return new TimeSpan(elapsedTicks);
}
```

### 4.3 æ™ºèƒ½é‡‡æ ·ç­–ç•¥

#### è‡ªé€‚åº”é‡‡æ ·ç‡

```csharp
public class AdaptiveSampler
{
    private float _currentSamplingRate = 1.0f;
    private int _recentCallCount = 0;
    private DateTime _lastAdjustment = DateTime.UtcNow;
    
    public bool ShouldSample(string methodName)
    {
        _recentCallCount++;
        
        // æ ¹æ®è°ƒç”¨é¢‘ç‡åŠ¨æ€è°ƒæ•´é‡‡æ ·ç‡
        if ((DateTime.UtcNow - _lastAdjustment).TotalSeconds >= 1.0)
        {
            AdjustSamplingRate();
            _lastAdjustment = DateTime.UtcNow;
            _recentCallCount = 0;
        }
        
        return Random.value <= _currentSamplingRate;
    }
    
    private void AdjustSamplingRate()
    {
        // é«˜é¢‘è°ƒç”¨é™ä½é‡‡æ ·ç‡ï¼Œä½é¢‘è°ƒç”¨æé«˜é‡‡æ ·ç‡
        if (_recentCallCount > 1000)
            _currentSamplingRate = Mathf.Max(0.1f, _currentSamplingRate * 0.8f);
        else if (_recentCallCount < 100)
            _currentSamplingRate = Mathf.Min(1.0f, _currentSamplingRate * 1.2f);
    }
}
```

---

## 5. ä½¿ç”¨æŒ‡å—

### 5.1 å¿«é€Ÿå¼€å§‹

#### æ­¥éª¤1: å¯ç”¨æ€§èƒ½ç›‘æ§

```csharp
// åœ¨æ¡†æ¶åˆå§‹åŒ–åå¯ç”¨æ€§èƒ½ç›‘æ§
var frameworkManager = FrameworkManager.Instance;
frameworkManager.Initialize();

var performanceMonitor = frameworkManager.GetModule<PerformanceMonitor>();
performanceMonitor.SetEnabled(true);
```

#### æ­¥éª¤2: æ ‡è®°éœ€è¦ç›‘æ§çš„æ–¹æ³•

```csharp
public class GameLogicModule : BaseModule
{
    [MonitorPerformance("æ¸¸æˆé€»è¾‘æ›´æ–°")]
    protected override void OnStart()
    {
        // æ¨¡å—å¯åŠ¨é€»è¾‘
    }
    
    [MonitorPerformance("AIè®¡ç®—", RecordToGlobalStats = true)]
    public void UpdateAI()
    {
        // AIæ›´æ–°é€»è¾‘
    }
}
```

#### æ­¥éª¤3: æ‰“å¼€ç›‘æ§ç•Œé¢

åœ¨Unityç¼–è¾‘å™¨ä¸­ï¼š`Cnoom Framework -> Performance Monitor`

### 5.2 é«˜çº§ç”¨æ³•

#### æ‰‹åŠ¨ç›‘æ§ä»£ç å—

```csharp
// ä½¿ç”¨ç›‘æ§ä½œç”¨åŸŸ
using (PerformanceInterceptor.CreateScope("å¤æ‚è®¡ç®—", "MathModule"))
{
    // éœ€è¦ç›‘æ§çš„ä»£ç 
    ComplexCalculation();
}

// ä½¿ç”¨æ‰©å±•æ–¹æ³•
var action = SomeHeavyOperation.WithPerformanceMonitoring("é‡å‹æ“ä½œ", "WorkerModule");
action();
```

#### è‡ªå®šä¹‰æ€§èƒ½äº‹ä»¶å¤„ç†

```csharp
public class CustomPerformanceHandler : BaseModule
{
    [BroadcastHandler]
    private void OnPerformanceWarning(PerformanceWarningEvent evt)
    {
        if (evt.ExecutionTime.TotalMilliseconds > 50)
        {
            Debug.LogWarning($"æ€§èƒ½è­¦å‘Š: {evt.OperationName} æ‰§è¡Œæ—¶é—´è¿‡é•¿ ({evt.ExecutionTime.TotalMilliseconds:F2}ms)");
        }
    }
    
    [BroadcastHandler]
    private void OnPerformanceReport(PerformanceReportEvent evt)
    {
        var report = evt.Report;
        Debug.Log($"æ€§èƒ½æŠ¥å‘Š: å¹³å‡æ‰§è¡Œæ—¶é—´ {report.AverageExecutionTime.TotalMilliseconds:F2}ms");
    }
}
```

### 5.3 é…ç½®é€‰é¡¹

#### é€šè¿‡é…ç½®æ–‡ä»¶

```json
{
  "Performance": {
    "EnableMonitoring": true,
    "SamplingInterval": 1.0,
    "MaxHistoryCount": 1000,
    "EnableMemoryTracking": true,
    "EnableModuleStats": true,
    "MonitoringLevel": "Method",
    "AutoExportInterval": 300
  }
}
```

#### é€šè¿‡ä»£ç é…ç½®

```csharp
var config = frameworkManager.ConfigManager;
config.SetValue("Performance.EnableMonitoring", true);
config.SetValue("Performance.SamplingInterval", 0.5f);
config.SetValue("Performance.MaxHistoryCount", 2000);
```

---

## 6. æ€§èƒ½ä¼˜åŒ–

### 6.1 ç›‘æ§å¼€é”€æœ€å°åŒ–

#### ç¼–è¯‘æ—¶ä¼˜åŒ–

```csharp
#if UNITY_EDITOR || DEVELOPMENT_BUILD
    [MonitorPerformance("å¼€å‘ç‰ˆæœ¬ç›‘æ§")]
    public void DevelopmentOnlyMethod() { }
#endif

// ä½¿ç”¨æ¡ä»¶ç¼–è¯‘å‡å°‘å‘å¸ƒç‰ˆæœ¬çš„ç›‘æ§å¼€é”€
[System.Diagnostics.Conditional("ENABLE_PERFORMANCE_MONITORING")]
public static void RecordMetrics(PerformanceMetrics metrics) { }
```

#### è¿è¡Œæ—¶ä¼˜åŒ–

```csharp
// ä½¿ç”¨å¯¹è±¡æ± é¿å…é¢‘ç¹åˆ†é…
private static readonly ObjectPool<PerformanceMetrics> MetricsPool = 
    new ObjectPool<PerformanceMetrics>(() => new PerformanceMetrics());

// æ‰¹é‡å¤„ç†å‡å°‘é”ç«äº‰
private readonly List<PerformanceMetrics> _batchBuffer = new List<PerformanceMetrics>();
private void ProcessMetricsBatch()
{
    lock (_batchBuffer)
    {
        foreach (var metrics in _batchBuffer)
        {
            ProcessSingleMetrics(metrics);
        }
        _batchBuffer.Clear();
    }
}
```

### 6.2 å†…å­˜ç®¡ç†ä¼˜åŒ–

#### æ™ºèƒ½ç¼“å­˜ç­–ç•¥

```csharp
public class PerformanceDataCache
{
    private readonly LRUCache<string, PerformanceStatistics> _statsCache;
    private readonly TimeBasedCache<PerformanceMetrics> _historyCache;
    
    public PerformanceDataCache(int maxSize, TimeSpan maxAge)
    {
        _statsCache = new LRUCache<string, PerformanceStatistics>(maxSize);
        _historyCache = new TimeBasedCache<PerformanceMetrics>(maxAge);
    }
    
    public void AddMetrics(PerformanceMetrics metrics)
    {
        // è‡ªåŠ¨æ¸…ç†è¿‡æœŸæ•°æ®
        _historyCache.Add(metrics.Timestamp, metrics);
        
        // æ›´æ–°ç»Ÿè®¡ç¼“å­˜
        var key = $"{metrics.ModuleName}.{metrics.MethodName}";
        _statsCache.GetOrAdd(key, () => new PerformanceStatistics(key))
                   .AddSample(metrics.ExecutionTime, metrics.MemoryDelta);
    }
}
```

### 6.3 å¼‚æ­¥å¤„ç†ä¼˜åŒ–

#### åå°æ•°æ®å¤„ç†

```csharp
public class AsyncPerformanceProcessor
{
    private readonly Channel<PerformanceMetrics> _metricsChannel;
    private readonly CancellationTokenSource _cancellationTokenSource;
    
    public AsyncPerformanceProcessor()
    {
        _metricsChannel = Channel.CreateUnbounded<PerformanceMetrics>();
        _ = Task.Run(ProcessMetricsAsync);
    }
    
    private async Task ProcessMetricsAsync()
    {
        await foreach (var metrics in _metricsChannel.Reader.ReadAllAsync(_cancellationTokenSource.Token))
        {
            // åœ¨åå°çº¿ç¨‹å¤„ç†æ€§èƒ½æ•°æ®
            await ProcessMetricsInBackground(metrics);
        }
    }
    
    public void EnqueueMetrics(PerformanceMetrics metrics)
    {
        _metricsChannel.Writer.TryWrite(metrics);
    }
}
```

---

## 7. æ‰©å±•æŒ‡å—

### 7.1 è‡ªå®šä¹‰æ€§èƒ½æŒ‡æ ‡

#### æ·»åŠ æ–°çš„æ€§èƒ½æŒ‡æ ‡

```csharp
public class CustomPerformanceMetrics : PerformanceMetrics
{
    public float CPUUsage { get; set; }
    public int NetworkRequests { get; set; }
    public float BatteryLevel { get; set; }
    
    // è‡ªå®šä¹‰æŒ‡æ ‡æ”¶é›†é€»è¾‘
    public static CustomPerformanceMetrics Collect(string operationName)
    {
        return new CustomPerformanceMetrics
        {
            OperationName = operationName,
            CPUUsage = GetCPUUsage(),
            NetworkRequests = GetActiveNetworkRequests(),
            BatteryLevel = SystemInfo.batteryLevel,
            Timestamp = DateTime.UtcNow
        };
    }
}
```

#### è‡ªå®šä¹‰ç›‘æ§ç‰¹æ€§

```csharp
[AttributeUsage(AttributeTargets.Method)]
public class MonitorNetworkPerformanceAttribute : MonitorPerformanceAttribute
{
    public bool TrackBandwidth { get; set; } = true;
    public bool TrackLatency { get; set; } = true;
    
    public override void OnMethodStart(MethodExecutionContext context)
    {
        base.OnMethodStart(context);
        
        if (TrackBandwidth)
            context.StartBandwidthMonitoring();
        if (TrackLatency)
            context.StartLatencyMonitoring();
    }
}
```

### 7.2 è‡ªå®šä¹‰å¯è§†åŒ–ç»„ä»¶

#### åˆ›å»ºè‡ªå®šä¹‰å›¾è¡¨

```csharp
public class CustomPerformanceChart : IPerformanceChart
{
    public void DrawChart(Rect rect, List<float> data, ChartStyle style)
    {
        // è‡ªå®šä¹‰å›¾è¡¨ç»˜åˆ¶é€»è¾‘
        DrawBackground(rect, style.BackgroundColor);
        DrawGridLines(rect, style.GridColor);
        DrawDataLine(rect, data, style.LineColor);
        DrawLabels(rect, data, style.LabelStyle);
    }
    
    private void DrawHeatmap(Rect rect, float[,] data)
    {
        // çƒ­åŠ›å›¾ç»˜åˆ¶é€»è¾‘
        for (int x = 0; x < data.GetLength(0); x++)
        {
            for (int y = 0; y < data.GetLength(1); y++)
            {
                var color = GetHeatmapColor(data[x, y]);
                var cellRect = GetCellRect(rect, x, y);
                EditorGUI.DrawRect(cellRect, color);
            }
        }
    }
}
```

### 7.3 é›†æˆå¤–éƒ¨ç›‘æ§ç³»ç»Ÿ

#### æ•°æ®å¯¼å‡ºæ¥å£

```csharp
public interface IPerformanceExporter
{
    Task ExportAsync(IEnumerable<PerformanceMetrics> metrics, ExportFormat format);
    bool SupportsFormat(ExportFormat format);
}

public class PrometheusExporter : IPerformanceExporter
{
    public async Task ExportAsync(IEnumerable<PerformanceMetrics> metrics, ExportFormat format)
    {
        var prometheusData = ConvertToPrometheusFormat(metrics);
        await SendToPrometheus(prometheusData);
    }
    
    private string ConvertToPrometheusFormat(IEnumerable<PerformanceMetrics> metrics)
    {
        var sb = new StringBuilder();
        foreach (var metric in metrics)
        {
            sb.AppendLine($"method_execution_time{{module=\"{metric.ModuleName}\",method=\"{metric.MethodName}\"}} {metric.ExecutionTime.TotalMilliseconds}");
            sb.AppendLine($"method_memory_delta{{module=\"{metric.ModuleName}\",method=\"{metric.MethodName}\"}} {metric.MemoryDelta}");
        }
        return sb.ToString();
    }
}
```

---

## ğŸ¯ æ€»ç»“

æœ¬è½»é‡çº§æ€§èƒ½ç›‘æ§æ–¹æ¡ˆä¸ºCnoom Unity Frameworkæä¾›äº†ï¼š

âœ… **å®Œæ•´çš„ç›‘æ§èƒ½åŠ›** - ä»æ–¹æ³•çº§åˆ°ç³»ç»Ÿçº§çš„å…¨é¢æ€§èƒ½ç›‘æ§
âœ… **æ— ä¾µå…¥æ€§è®¾è®¡** - é€šè¿‡ç‰¹æ€§å’Œæ‹¦æˆªå™¨å®ç°é€æ˜ç›‘æ§
âœ… **å®æ—¶å¯è§†åŒ–ç•Œé¢** - Unityç¼–è¾‘å™¨å†…ç½®çš„ç›´è§‚ç›‘æ§ä»ªè¡¨ç›˜
âœ… **é«˜æ€§èƒ½å®ç°** - æœ€å°åŒ–ç›‘æ§å¼€é”€ï¼Œæ”¯æŒç”Ÿäº§ç¯å¢ƒä½¿ç”¨
âœ… **çµæ´»çš„æ‰©å±•æ€§** - æ”¯æŒè‡ªå®šä¹‰æŒ‡æ ‡ã€å›¾è¡¨å’Œå¯¼å‡ºæ ¼å¼
âœ… **æ™ºèƒ½åŒ–ç‰¹æ€§** - è‡ªé€‚åº”é‡‡æ ·ã€å¼‚æ­¥å¤„ç†ã€æ™ºèƒ½ç¼“å­˜

é€šè¿‡è¿™å¥—æ–¹æ¡ˆï¼Œå¼€å‘è€…å¯ä»¥è½»æ¾ç›‘æ§Unityé¡¹ç›®çš„æ€§èƒ½çŠ¶å†µï¼Œå¿«é€Ÿè¯†åˆ«æ€§èƒ½ç“¶é¢ˆï¼Œä¼˜åŒ–ä»£ç è´¨é‡ï¼Œæå‡ç”¨æˆ·ä½“éªŒã€‚